#!/bin/bash
# Snippet from https://github.com/girst/hardpass-sendHID/blob/master/README.md . In which, the following notice was left:

# this is a stripped down version of https://github.com/ckuethe/usbarmory/wiki/USB-Gadgets - I don't claim any rights

modprobe libcomposite
cd /sys/kernel/config/usb_gadget/
mkdir -p g1
cd g1
echo 0x054C > idVendor
echo 0x05C4 > idProduct
echo 0x0100 > bcdDevice # v1.0.0
echo 0x0200 > bcdUSB # USB2
mkdir -p strings/0x409
echo "deadbeef01234567890" > strings/0x409/serialnumber
echo "example.com" > strings/0x409/manufacturer
echo "Wireless Controller" > strings/0x409/product
N="usb0"
mkdir -p functions/hid.$N
echo 0 > functions/hid.usb0/protocol
echo 0 > functions/hid.usb0/subclass
echo 8 > functions/hid.usb0/report_length
echo -ne \\x05\\x01\\x09\\x05\\xA1\\x01\\x85\\x01\\x09\\x30\\x09\\x31\\x09\\x32\\x09\\x35\\x15\\x00\\x26\\xFF\\x75\\x08\\x95\\x04\\x81\\x02\\x09\\x39\\x15\\x00\\x25\\x07\\x35\\x00\\x46\\x3B\\x65\\x14\\x75\\x04\\x95\\x01\\x81\\x42\\x65\\x00\\x05\\x09\\x19\\x01\\x29\\x0E\\x15\\x00\\x25\\x01\\x75\\x01\\x95\\x0E\\x81\\x02\\x06\\x00\\x09\\x20\\x75\\x06\\x95\\x01\\x15\\x00\\x25\\x7F\\x81\\x02\\x05\\x01\\x09\\x33\\x09\\x34\\x15\\x00\\x26\\xFF\\x75\\x08\\x95\\x02\\x81\\x02\\x06\\x00\\x09\\x21\\x95\\x36\\x81\\x02\\x85\\x05\\x09\\x22\\x95\\x1F\\x91\\x02\\x85\\x04\\x09\\x23\\x95\\x24\\xB1\\x02\\x85\\x02\\x09\\x24\\x95\\x24\\xB1\\x02\\x85\\x08\\x09\\x25\\x95\\x03\\xB1\\x02\\x85\\x10\\x09\\x26\\x95\\x04\\xB1\\x02\\x85\\x11\\x09\\x27\\x95\\x02\\xB1\\x02\\x85\\x12\\x06\\x02\\x09\\x21\\x95\\x0F\\xB1\\x02\\x85\\x13\\x09\\x22\\x95\\x16\\xB1\\x02\\x85\\x14\\x06\\x05\\x09\\x20\\x95\\x10\\xB1\\x02\\x85\\x15\\x09\\x21\\x95\\x2C\\xB1\\x02\\x06\\x80\\x85\\x80\\x09\\x20\\x95\\x06\\xB1\\x02\\x85\\x81\\x09\\x21\\x95\\x06\\xB1\\x02\\x85\\x82\\x09\\x22\\x95\\x05\\xB1\\x02\\x85\\x83\\x09\\x23\\x95\\x01\\xB1\\x02\\x85\\x84\\x09\\x24\\x95\\x04\\xB1\\x02\\x85\\x85\\x09\\x25\\x95\\x06\\xB1\\x02\\x85\\x86\\x09\\x26\\x95\\x06\\xB1\\x02\\x85\\x87\\x09\\x27\\x95\\x23\\xB1\\x02\\x85\\x88\\x09\\x28\\x95\\x22\\xB1\\x02\\x85\\x89\\x09\\x29\\x95\\x02\\xB1\\x02\\x85\\x90\\x09\\x30\\x95\\x05\\xB1\\x02\\x85\\x91\\x09\\x31\\x95\\x03\\xB1\\x02\\x85\\x92\\x09\\x32\\x95\\x03\\xB1\\x02\\x85\\x93\\x09\\x33\\x95\\x0C\\xB1\\x02\\x85\\xA0\\x09\\x40\\x95\\x06\\xB1\\x02\\x85\\xA1\\x09\\x41\\x95\\x01\\xB1\\x02\\x85\\xA2\\x09\\x42\\x95\\x01\\xB1\\x02\\x85\\xA3\\x09\\x43\\x95\\x30\\xB1\\x02\\x85\\xA4\\x09\\x44\\x95\\x0D\\xB1\\x02\\x85\\xA5\\x09\\x45\\x95\\x15\\xB1\\x02\\x85\\xA6\\x09\\x46\\x95\\x15\\xB1\\x02\\x85\\xF0\\x09\\x47\\x95\\x3F\\xB1\\x02\\x85\\xF1\\x09\\x48\\x95\\x3F\\xB1\\x02\\x85\\xF2\\x09\\x49\\x95\\x0F\\xB1\\x02\\x85\\xA7\\x09\\x4A\\x95\\x01\\xB1\\x02\\x85\\xA8\\x09\\x4B\\x95\\x01\\xB1\\x02\\x85\\xA9\\x09\\x4C\\x95\\x08\\xB1\\x02\\x85\\xAA\\x09\\x4E\\x95\\x01\\xB1\\x02\\x85\\xAB\\x09\\x4F\\x95\\x39\\xB1\\x02\\x85\\xAC\\x09\\x50\\x95\\x39\\xB1\\x02\\x85\\xAD\\x09\\x51\\x95\\x0B\\xB1\\x02\\x85\\xAE\\x09\\x52\\x95\\x01\\xB1\\x02\\x85\\xAF\\x09\\x53\\x95\\x02\\xB1\\x02\\x85\\xB0\\x09\\x54\\x95\\x3F\\xB1\\x02\\xC0 > functions/hid.usb0/report_desc
C=1
mkdir -p configs/c.$C/strings/0x409
echo "Config $C: ECM network" > configs/c.$C/strings/0x409/configuration 
echo 250 > configs/c.$C/MaxPower 
ln -s functions/hid.$N configs/c.$C/
ls /sys/class/udc > UDC
